# Deltachat URI-Schemes

Currently URI schemes are mainly supported by the app-internal QRcode scanner, at this time only `openpgp4fpr` (used for securejoin) is also registered as uri scheme handler on all platforms ([android](https://github.com/deltachat/deltachat-android), [ios](https://github.com/deltachat/deltachat-ios) and [desktop](https://github.com/deltachat/deltachat-desktop))

- related forum topic: https://support.delta.chat/t/custom-deltachat-url-uri-scheme/346
- core sourcecode that handles uri schemes: https://github.com/deltachat/deltachat-core-rust/blob/master/src/qr.rs and https://github.com/deltachat/deltachat-core-rust/blob/master/src/securejoin/qrinvite.rs

## **chat.delta**

Generic deltachat scheme, currently used by android as callback url for the oauth2 login method.
| | |
| ------------------- | ------------------------------- |
| Scheme | `chat.delta` |
| Used for | oauth2 Login (only android currently) |
| Related Terms\* | - |
| Available on | iOS (defined, but not used yet), android |
| Handled by the core| No|
| Other apps using it | none, only DeltaChat |
| Notes | Only used as scheme currently, not in qr codes |

### Syntax

[TODO]

### Reference

https://github.com/deltachat/deltachat-android/blob/8d9c02dd7a2be33fe588e0b9469be56fb0435a62/AndroidManifest.xml#L192-L195

```xml
<!-- this scheme is used as the redirect_url for getOauth2Url()
    and should be whitelisted by the supported oauth2 services -->
<data android:scheme="chat.delta" android:path="/${applicationId}/auth" tools:ignore="AppLinkUrlError"/>
<data android:scheme="chat.delta" android:path="/auth" tools:ignore="AppLinkUrlError"/>
```

## **OPENPGP4FPR** <a name="OPENPGP4FPR"></a>

|                         |                                 |
| ----------------------- | ------------------------------- |
| Scheme                  | `OPENPGP4FPR:`                  |
| Used for                | Verify Contact and Join a group |
| Related Terms\*         | Securejoin                      |
| Available on            | iOS, android, desktop           |
| Decoded by the core\*\* | Yes                             |
| Other apps using it     | <li>OpenKeychain(android)</li>  |

### Syntax

```
OPENPGP4FPR:FINGERPRINT#a=ADDR&n=NAME&i=INVITENUMBER&s=AUTH
OPENPGP4FPR:FINGERPRINT#a=ADDR&g=GROUPNAME&x=GROUPID&i=INVITENUMBER&s=AUTH
```

The fields `a`, `g` and `n` are URL encoded.
`i` & `s` are 66 random bits endcoded as base-64.

> Note: Everything after `#` is a Delta Chat extension

#### Examples

verify contact

```
OPENPGP4FPR:EEA98F87742EF2FD6C23677F1E1142828C202998#a=demo.fn8hk%40five.chat&n=&i=rd82URz8_ac&s=MFRLUHvIHlq
```

join regular group

```
OPENPGP4FPR:EEA98F87742EF2FD6C23677F1E1142828C202998#a=demo.fn8hk%40five.chat&g=groupname2&x=iNekF7uW509&i=xW0ZAcLUQDf&s=OYV-PWe63Vv
```

join verified/protected group (same format as join regular group)

```
OPENPGP4FPR:EEA98F87742EF2FD6C23677F1E1142828C202998#a=demo.fn8hk%40five.chat&g=groupname&x=ylTH55NJF24&i=PpDNY9sRkh-&s=F8di8fNDToQ
```

## **DCACCOUNT** <a name="DCACCOUNT"></a>

|                          |                                                    |
| ------------------------ | -------------------------------------------------- |
| Scheme                   | `DCACCOUNT:`                                       |
| Used for                 | Account setup                                      |
| Related Terms\*          | Burner Accounts                                    |
| Available on             | iOS (only QR), android(only QR), desktop (only QR) |
| Decoded by the core \*\* | Yes                                                |
| Other apps using it      | none, only DeltaChat                               |

### Syntax

currently this only accepts a url that gives back account setup information as a json object.
see the [mailadm](https://github.com/deltachat/mailadm) project for more details as this api was designed for use with burner account qr codes generated by mailadm.

```
DCACCOUNT:https://example.org/new_email?t=1w_7wDjgjelxeX884x96v3
```

You may want to use [`DCLOGIN`](#DCLOGIN) instead, if you want a qr code containing login information for a single account.

#### The http endpoint needs the following api:

##### On Success

HTTP Status code 200

```ts
{
    email: string,
    password: string
}
```

json object can have other properties too, but currently they are ignored by core.

##### On Error

HTTP Status code: NOT 2XX, idealy the 4XX if it's user error and 5XX if it's the servers fault

```ts
{
    // The user facing error string, should explain what failed.
    error: string,
}
```

json object can have other properties too, but currently they are ignored by core.

## **DCLOGIN** <a name="DCLOGIN"></a>

|                          |                       |
| ------------------------ | --------------------- |
| Scheme                   | `DCLOGIN:`            |
| Used for                 | Account setup         |
| Related Terms\*          | Account Login QR code |
| Available on             | draft                 |
| Decoded by the core \*\* | draft                 |
| Other apps using it      | none, only DeltaChat  |

### Syntax

```
dclogin://user:password@host/?options
dclogin://user:password@host?options
dclogin:user:password@host/?options
# example: (email: me@example.com, password: securePassword)
dclogin://me:securePassword@example.com?v=1
# example: (email: myself@example.com, password: 123456, insecure smtp at different server)
dclogin://myself:123456@example.com?v=1&sh=mail.example.com&sc=3&ss=plain
```

#### Options `?options`

Format: URL Query parameters also known as GET variables (`varname=value` behind the question mark, chained/delimited by `&`)

The query parameters contain advanced options and a version parameter.
All advanced options are optional except for `v`, which is the only required option at this point.

| short name | stands for                | description                                         | example               |
| ---------- | ------------------------- | --------------------------------------------------- | --------------------- |
| `v`        | `version`                 | defines the format version, more explanation below  | `v=1`                 |
| ---------- | ------------------------- | --------------------------------------------------- | ----------------      |
| `ih`       | `imap_host`               | IMAP host                                           | `ih=imap.example.com` |
| `ip`       | `imap_port`               | IMAP port                                           | `ip=993`              |
| `iu`       | `imap_username`           | IMAP username                                       |                       |
| `ipw`      | `imap_password`           | IMAP password                                       |                       |
| `is`       | `imap_security`           | IMAP security: "`ssl`" or "`default`"               | `is=ssl`              |
| `ic`       | `imap_certificate_checks` | IMAP certificate checks, see below for options      | `ic=1`                |
| ---------- | ------------------------- | --------------------------------------------------- | ----------------      |
| `sh`       | `smtp_host`               | SMTP host                                           | `sh=mail.example.com` |
| `sp`       | `smtp_port`               | SMTP port                                           | `sp=465`              |
| `su`       | `smtp_username`           | SMTP username                                       |                       |
| `spw`      | `smtp_password`           | SMTP password                                       |                       |
| `ss`       | `smtp_security`           | SMTP security: "`ssl`", "`starttls`" or "`plain`"   | `ss=plain`            |
| `sc`       | `smtp_certificate_checks` | SMTP certificate checks, see below for options      | `sc=3`                |

#### `minVersion`

Format version:
Used for breaking new versions that add new **required** properties, basically deltachat checks for this and if it's newer than the version deltachat supports it prompts the user to update the app.

The version number only increases on incompatible changes (changes to required properties).

#### `CertificateChecks`

| code | name & description                                                                                               |
| ---- | ---------------------------------------------------------------------------------------------------------------- |
| 0    | `Automatic`, same as `AcceptInvalidCertificates` unless overridden by `strict_tls` setting in provider database. |
| 1    | `Strict`                                                                                                         |
| 3    | `AcceptInvalidCertificates`                                                                                      |

#### Important information for using the `DCLOGIN:` scheme

- There is a maximum length of how much data fits in side of a qr code (depending on the error correction level 1273 chars to 2953 chars)
  - only use the short names for advanced properties
  - If working with long domains/password/usernames in advanced options, **consider creating a configuration file at the server instead** using either [Autoconfigure](https://web.archive.org/web/20210402044801/https://developer.mozilla.org/en-US/docs/Mozilla/Thunderbird/Autoconfiguration) or [Autodiscover](<https://technet.microsoft.com/library/bb124251(v=exchg.150).aspx>)
- **Every value** (username & password too) **needs to be URI encoded**:
  - [`encodeURIComponent()` in JS](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)
- note that email username and password are in different order, than email: `username:password@host` vs. `username@host`

#### Implementation hints

implementations should be somewhat tolerant:

- both `dclogin:` and `dclogin://` should work
- only implement short names (not the full names they stand for)
- have a test for usename+extention@host cases
- if version is bigger than whats implemented tell the user to update

## **DCWEBRTC**

|                          |                                                          |
| ------------------------ | -------------------------------------------------------- |
| Scheme                   | `DCWEBRTC:`                                              |
| Used for                 | Setting the `WebrtcInstance` config value from an qrcode |
| Related Terms\*          | webrtc_instance                                          |
| Available on             | ? [TODO]                                                 |
| Decoded by the core \*\* | Yes                                                      |
| Other apps using it      | none, only DeltaChat                                     |

### Syntax

```
DCWEBRTC:[address of video call service]
```

#### Variables:

Here is a list of variables that can be used in the config value, these might not be updated in the future, so you should also check to current documentation if it doesn't work.

- `$ROOM` gets replaced with a random string.
- `$NOROOM` gets replcaed with an empty string
- if no variable is set a random string is appended to the url

#### Examples

jitsi

```
DCWEBRTC:https://meet.jit.si/$ROOM
```

service with no random roomname, webex in this case

```
DCWEBRTC:https://choosenname.my.webex.com/meet/me/$NOROOM
```

## **mailto** <a name="MAILTO"></a>

Usable as share to deltachat.

|                     |                                                            |
| ------------------- | ---------------------------------------------------------- |
| Scheme              | `mailto:`                                                  |
| Used for            | sharing to deltachat, creating a contact                   |
| Related Terms\*     | -                                                          |
| Available on        | android, [TODO do desktop and ios support it?]             |
| Decoded by the core | Yes, partially (only extracts address and creates contact) |
| Other apps using it | most other email clients                                   |

### Syntax

```
mailto:[addr]?subject=[subject]&body=[body]
```

standard mailto syntax though deltachat might not respect all options yet, probably refer to https://tools.ietf.org/html/rfc2368 and https://tools.ietf.org/html/rfc6068.

## **SMTP** (unused?)

similar to [`mailto:`](#MAILTO)

|                     |                                                            |
| ------------------- | ---------------------------------------------------------- |
| Scheme              | `SMTP:`                                                    |
| Used for            | sharing to deltachat, creating a contact                   |
| Related Terms\*     | -                                                          |
| Available on        | ? [TODO]                                                   |
| Decoded by the core | Yes, partially (only extracts address and creates contact) |
| Other apps using it | ?                                                          |

### Syntax

```
SMTP:[addr]:[subject]:[body]
```

## **MATMSG** (unused?)

similar to [`mailto:`](#MAILTO)

|                     |                                                            |
| ------------------- | ---------------------------------------------------------- |
| Scheme              | `MATMSG:`                                                  |
| Used for            | sharing to deltachat, creating a contact                   |
| Related Terms\*     | -                                                          |
| Available on        | ? [TODO]                                                   |
| Decoded by the core | Yes, partially (only extracts address and creates contact) |
| Other apps using it | ?                                                          |

### Syntax

```
MATMSG:TO:[addr];SUB:[subject];BODY:[body];
```

## **BEGIN:VCARD**

|                     |                     |
| ------------------- | ------------------- |
| Scheme              | `BEGIN:VCARD`       |
| Used for            | importing a contact |
| Related Terms\*     | vcard               |
| Available on        | ? [TODO]            |
| Decoded by the core | Yes                 |
| Other apps using it | ?                   |

### Syntax

```
VCARD:BEGIN\nN:last name;first name;...;\nEMAIL;<type>:addr...;
```

## URI schemes that are qrcode reader only

- `http://` & `https://` - to make the qr code scanner more complete and allow users to scan common qr codes.

## Registered Handlers per Platform

List of which schemes the app is registered to handle in the OS.
When an scheme is reqistered as a handler

| Platform | Schemes                                               | Sources (and a keyword to look for when the line-numbers have changed)                                                                                                                                                                                                                                                                                                                               |
| -------- | ----------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| iOS      | `chat.delta`, [`openpgp4fpr`](#OPENPGP4FPR)           | [deltachat-ios/Info.plist](https://github.com/deltachat/deltachat-ios/blob/master/deltachat-ios/Info.plist#L28-L32) CFBundleURLSchemes                                                                                                                                                                                                                                                               |
| android  | `mailto`, `chat.delta`, [`openpgp4fpr`](#OPENPGP4FPR) | [AndroidManifest.xml](https://github.com/deltachat/deltachat-android/blob/8d9c02dd7a2be33fe588e0b9469be56fb0435a62/AndroidManifest.xml) search for `android:scheme`                                                                                                                                                                                                                                  |
| desktop  | [`openpgp4fpr`](#OPENPGP4FPR)                         | [build/gen-electron-builder-config.js](https://github.com/deltachat/deltachat-desktop/blob/eddd9d9a12169e1ad8b363198b0b3abb5ccde209/build/gen-electron-builder-config.js#L74-L78) build['protocols'] <br /> [src/main/windows/main.ts#L61](https://github.com/deltachat/deltachat-desktop/blob/988bade7c44b17665f91d013e04d8a5a877c6889/src/main/windows/main.ts#L61) app.on('open-url', ...) <br /> |

## Footnote / Legend

\* terms that are used in the project that are related to it. Sometimes there are multiple terms refering to the same thing, for example contact requests are still sometimes refered to as "dead drops".

\*\* wether the core has logic to detect and decode it
